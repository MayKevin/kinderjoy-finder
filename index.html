<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Kinderjoy Seriennummer ‚Üí Figur (Stranger Things)</title>
  <style>
    :root { --bg:#0b1020; --card:#121935; --muted:#95a3b3; --accent:#8ad0ff; --ok:#a7f3d0; --warn:#ffd166; }
    *{box-sizing:border-box}
    body{margin:0; font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif; background:linear-gradient(180deg,#0b1020,#0c142a); color:#e9eef5}
    .wrap{max-width:1100px;margin:36px auto;padding:0 16px}
    h1{font-size:clamp(1.4rem,2.5vw,2rem);margin:0 0 12px 0}
    p.lead{color:var(--muted);margin:0 0 18px 0}
    .card{background:var(--card);border:1px solid #1f2a4a;border-radius:16px;box-shadow:0 10px 30px rgba(0,0,0,.25);padding:18px}
    .grid{display:grid;gap:14px}
    @media(min-width:950px){.grid{grid-template-columns:1fr 1fr}}
    label{display:block;font-size:.9rem;margin-bottom:6px;color:#c8d3e4}
    input,textarea,button,select{width:100%;padding:12px 14px;border-radius:12px;border:1px solid #243154;background:#0c1328;color:#e9eef5}
    input:focus,textarea:focus,select:focus{outline:2px solid var(--accent);border-color:var(--accent)}
    .row{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    .btn{cursor:pointer;background:linear-gradient(180deg,#1f76ff,#1856c4);border:none}
    .btn.secondary{background:#192344}
    .result{padding:14px;border-radius:12px;background:#0b1531;border:1px solid #233159}
    .muted{color:var(--muted)}
    .list{display:flex;flex-wrap:wrap;gap:8px}
    .list .chip{background:#111a34;border:1px solid #22315a;border-radius:999px;padding:6px 10px}
    .table{width:100%;border-collapse:collapse;margin-top:8px}
    .table th,.table td{padding:10px;border-bottom:1px solid #22315a;text-align:left}
    .badge{padding:2px 8px;border:1px solid #2b3a63;border-radius:999px;background:#101939;margin-left:6px;font-size:.8rem}
  </style>
</head>
<body>
  <div class="wrap">
    <h1>üîç Kinderjoy Seriennummer ‚Üí Figur (Stranger Things)</h1>
    <p class="lead">Diese Seite enth√§lt bereits <strong>deine Excel-Daten</strong>. Du kannst √ºber Seriennummer ODER direkt √ºber Figur suchen. Gewicht hilft, genauer einzugrenzen.</p>

    <div class="grid">
      <!-- Suche nach Seriennummer / Gewicht -->
      <div class="card">
        <h3 style="margin-top:0">Suche nach Seriennummer</h3>
        <div class="row">
          <div>
            <label for="code">Seriennummer</label>
            <input id="code" placeholder="z.B. 22S1" autocomplete="off" />
          </div>
          <div>
            <label for="weight">Gewicht (g) ‚Äì optional</label>
            <input id="weight" placeholder="z.B. 31.6" inputmode="decimal" />
          </div>
        </div>
        <div class="row" style="margin-top:12px">
          <button class="btn" id="checkBtn">Ergebnis anzeigen</button>
          <button class="btn secondary" id="resetBtn">Zur√ºcksetzen</button>
        </div>
        <div class="result" id="out" style="margin-top:12px">Gib oben eine Seriennummer ein.</div>
      </div>

      <!-- Suche nach Figur -->
      <div class="card">
        <h3 style="margin-top:0">Suche nach Figur</h3>
        <div class="row">
          <div>
            <label for="figureSel">Figur w√§hlen</label>
            <select id="figureSel"><option value="">‚Äì Figur ausw√§hlen ‚Äì</option></select>
          </div>
          <div>
            <label for="wFigure">Gewicht (g) ‚Äì optional (pr√ºft passende Codes f√ºr diese Figur)</label>
            <input id="wFigure" placeholder="z.B. 31.6" inputmode="decimal" />
          </div>
        </div>
        <div class="row" style="margin-top:12px">
          <button class="btn" id="figureBtn">Zuordnungen anzeigen</button>
          <button class="btn secondary" id="figureReset">Zur√ºcksetzen</button>
        </div>
        <div class="result" id="figureOut" style="margin-top:12px">W√§hle eine Figur aus.</div>
      </div>
    </div>

    <div class="card" style="margin-top:14px">
      <strong>Aktiver Datenstand</strong>
      <span class="badge" id="statCount">0 Eintr√§ge</span>
      <table class="table" id="previewTable" style="margin-top:8px;display:none">
        <thead><tr><th>Seriennummer</th><th>Figur</th><th>Gewicht min‚Äìmax</th></tr></thead>
        <tbody></tbody>
      </table>
    </div>

    <details class="card" style="margin-top:14px">
      <summary>üì• Optional: Eigene CSV laden / einf√ºgen</summary>
      <p class="muted" style="margin:8px 0 6px">Format: <code>Seriennummer,Figur,Gewicht_min,Gewicht_max</code></p>
      <div class="row">
        <div>
          <label for="csvfile">CSV-Datei w√§hlen</label>
          <input type="file" id="csvfile" accept=".csv" />
        </div>
        <div>
          <label for="paste">‚Ä¶oder hier einf√ºgen</label>
          <textarea id="paste" placeholder="22S1,Steve,31.2,31.9&#10;40S1,Robin + Steve Stiftfigur,31.0,31.5"></textarea>
        </div>
      </div>
      <div class="row" style="margin-top:10px">
        <button class="btn" id="loadCsvBtn">Daten √ºbernehmen</button>
        <button class="btn secondary" id="sampleBtn">Beispieldaten laden</button>
      </div>
    </details>
  </div>

<script>
  // Eingebettete Daten
  let rows = [{"code": "8S1", "figure": "Demogorgon", "wmin": 31.3, "wmax": 31.9}, {"code": "17S1", "figure": "Demogorgon", "wmin": 31.3, "wmax": 31.9}, {"code": "25S1", "figure": "Demogorgon", "wmin": 31.3, "wmax": 31.9}, {"code": "32S1", "figure": "Demogorgon", "wmin": 31.3, "wmax": 31.9}, {"code": "48S1", "figure": "Demogorgon", "wmin": 31.3, "wmax": 31.9}, {"code": "16S1", "figure": "Demogorgon Stiftfigur", "wmin": 32.0, "wmax": 32.5}, {"code": "28S1", "figure": "Demogorgon Stiftfigur", "wmin": 32.0, "wmax": 32.5}, {"code": "43S1", "figure": "Demogorgon Stiftfigur", "wmin": 32.0, "wmax": 32.5}, {"code": "45S1", "figure": "Demogorgon Stiftfigur", "wmin": 32.0, "wmax": 32.5}, {"code": "4S1", "figure": "Demogorgon Anh√§nger", "wmin": 30.3, "wmax": 31.9}, {"code": "8S1", "figure": "Demogorgon Anh√§nger", "wmin": 30.3, "wmax": 31.9}, {"code": "17S1", "figure": "Demogorgon Anh√§nger", "wmin": 30.3, "wmax": 31.9}, {"code": "32S1", "figure": "Demogorgon Anh√§nger", "wmin": 30.3, "wmax": 31.9}, {"code": "33S1", "figure": "Demogorgon Anh√§nger", "wmin": 30.3, "wmax": 31.9}, {"code": "36S1", "figure": "Demogorgon Anh√§nger", "wmin": 30.3, "wmax": 31.9}, {"code": "7S1", "figure": "Dustin", "wmin": 32.4, "wmax": 32.7}, {"code": "10S1", "figure": "Dustin", "wmin": 32.4, "wmax": 32.7}, {"code": "26S1", "figure": "Dustin", "wmin": 32.4, "wmax": 32.7}, {"code": "31S1", "figure": "Dustin", "wmin": 32.4, "wmax": 32.7}, {"code": "39S1", "figure": "Dustin", "wmin": 32.4, "wmax": 32.7}, {"code": "47S1", "figure": "Dustin", "wmin": 32.4, "wmax": 32.7}, {"code": "9S1", "figure": "Dustin upside Down", "wmin": 30.8, "wmax": 31.2}, {"code": "17S1", "figure": "Dustin upside Down", "wmin": 30.8, "wmax": 31.2}, {"code": "25S1", "figure": "Dustin upside Down", "wmin": 30.8, "wmax": 31.2}, {"code": "25S1", "figure": "Eddi Kabelanh√§nger", "wmin": 32.2, "wmax": 32.8}, {"code": "26S1", "figure": "Eddi Kabelanh√§nger", "wmin": 32.2, "wmax": 32.8}, {"code": "31S1", "figure": "Eddi Kabelanh√§nger", "wmin": 32.2, "wmax": 32.8}, {"code": "39S1", "figure": "Eddi Kabelanh√§nger", "wmin": 32.2, "wmax": 32.8}, {"code": "42S1", "figure": "Eddi Kabelanh√§nger", "wmin": 32.2, "wmax": 32.8}, {"code": "47S1", "figure": "Eddi Kabelanh√§nger", "wmin": 32.2, "wmax": 32.8}, {"code": "43S1", "figure": "Elf", "wmin": 31.0, "wmax": 31.0}, {"code": "14S1", "figure": "Elf Anh√§nger", "wmin": 29.5, "wmax": 29.8}, {"code": "22S1", "figure": "Elf Anh√§nger", "wmin": 29.5, "wmax": 29.8}, {"code": "27S1", "figure": "Elf Anh√§nger", "wmin": 29.5, "wmax": 29.8}, {"code": "35S1", "figure": "Elf Anh√§nger", "wmin": 29.5, "wmax": 29.8}, {"code": "43S1", "figure": "Elf Anh√§nger", "wmin": 29.5, "wmax": 29.8}, {"code": "46S1", "figure": "Elf Anh√§nger", "wmin": 29.5, "wmax": 29.8}, {"code": "24S1", "figure": "Elf Handyhalter", "wmin": 32.2, "wmax": 32.4}, {"code": "33S1", "figure": "Elf Handyhalter", "wmin": 32.2, "wmax": 32.4}, {"code": "26S1", "figure": "Erica Kabelanh√§nger", "wmin": 31.4, "wmax": 31.7}, {"code": "39S1", "figure": "Erica Kabelanh√§nger", "wmin": 31.4, "wmax": 31.7}, {"code": "10S1", "figure": "Hopper", "wmin": 31.4, "wmax": 31.9}, {"code": "15S1", "figure": "Hopper", "wmin": 31.4, "wmax": 31.9}, {"code": "24S1", "figure": "Hopper", "wmin": 31.4, "wmax": 31.9}, {"code": "25S1", "figure": "Hopper", "wmin": 31.4, "wmax": 31.9}, {"code": "30S1", "figure": "Hopper", "wmin": 31.4, "wmax": 31.9}, {"code": "31S1", "figure": "Hopper", "wmin": 31.4, "wmax": 31.9}, {"code": "39S1", "figure": "Hopper", "wmin": 31.4, "wmax": 31.9}, {"code": "25S1", "figure": "Hopper upside Down", "wmin": 30.7, "wmax": 31.0}, {"code": "29S1", "figure": "Hopper upside Down", "wmin": 30.7, "wmax": 31.0}, {"code": "4S1", "figure": "Lucas", "wmin": 30.5, "wmax": 31.0}, {"code": "20S1", "figure": "Lucas", "wmin": 30.5, "wmax": 31.0}, {"code": "21S1", "figure": "Lucas", "wmin": 30.5, "wmax": 31.0}, {"code": "29S1", "figure": "Lucas", "wmin": 30.5, "wmax": 31.0}, {"code": "11S1", "figure": "Max", "wmin": 32.6, "wmax": 33.0}, {"code": "14S1", "figure": "Max", "wmin": 32.6, "wmax": 33.0}, {"code": "21S1", "figure": "Max", "wmin": 32.6, "wmax": 33.0}, {"code": "27S1", "figure": "Max", "wmin": 32.6, "wmax": 33.0}, {"code": "28S1", "figure": "Max", "wmin": 32.6, "wmax": 33.0}, {"code": "35S1", "figure": "Max", "wmin": 32.6, "wmax": 33.0}, {"code": "18S1", "figure": "Max upside Down", "wmin": 30.0, "wmax": 30.5}, {"code": "24S1", "figure": "Max upside Down", "wmin": 30.0, "wmax": 30.5}, {"code": "26S1", "figure": "Max upside Down", "wmin": 30.0, "wmax": 30.5}, {"code": "31S1", "figure": "Max upside Down", "wmin": 30.0, "wmax": 30.5}, {"code": "47S1", "figure": "Max upside Down", "wmin": 30.0, "wmax": 30.5}, {"code": "47S1", "figure": "Mike", "wmin": 32.3, "wmax": 32.3}, {"code": "3S1", "figure": "Nancy Kabelanh√§nger", "wmin": 32.7, "wmax": 33.3}, {"code": "27S1", "figure": "Nancy Kabelanh√§nger", "wmin": 32.7, "wmax": 33.3}, {"code": "30S1", "figure": "Nancy Kabelanh√§nger", "wmin": 32.7, "wmax": 33.3}, {"code": "1S1", "figure": "Robin + Steve Stiftfigur", "wmin": 34.0, "wmax": 34.3}, {"code": "5S1", "figure": "Robin + Steve Stiftfigur", "wmin": 34.0, "wmax": 34.3}, {"code": "29S1", "figure": "Robin + Steve Stiftfigur", "wmin": 34.0, "wmax": 34.3}, {"code": "40S1", "figure": "Robin + Steve Stiftfigur", "wmin": 34.0, "wmax": 34.3}, {"code": "44S1", "figure": "Robin + Steve Stiftfigur", "wmin": 34.0, "wmax": 34.3}, {"code": "1S1", "figure": "Steve", "wmin": 31.4, "wmax": 31.9}, {"code": "4S1", "figure": "Steve", "wmin": 31.4, "wmax": 31.9}, {"code": "9S1", "figure": "Steve", "wmin": 31.4, "wmax": 31.9}, {"code": "19S1", "figure": "Steve", "wmin": 31.4, "wmax": 31.9}, {"code": "21S1", "figure": "Steve", "wmin": 31.4, "wmax": 31.9}, {"code": "22S1", "figure": "Steve", "wmin": 31.4, "wmax": 31.9}, {"code": "28S1", "figure": "Steve", "wmin": 31.4, "wmax": 31.9}, {"code": "33S1", "figure": "Steve", "wmin": 31.4, "wmax": 31.9}, {"code": "46S1", "figure": "Steve upside Down", "wmin": 31.0, "wmax": 31.6}, {"code": "22S1", "figure": "Steve upside Down", "wmin": 31.0, "wmax": 31.6}, {"code": "3S1", "figure": "Vecna Handyhalter", "wmin": 31.6, "wmax": 32.2}, {"code": "7S1", "figure": "Vecna Handyhalter", "wmin": 31.6, "wmax": 32.2}, {"code": "19S1", "figure": "Vecna Handyhalter", "wmin": 31.6, "wmax": 32.2}, {"code": "26S1", "figure": "Vecna Handyhalter", "wmin": 31.6, "wmax": 32.2}, {"code": "27S1", "figure": "Vecna Handyhalter", "wmin": 31.6, "wmax": 32.2}, {"code": "35S1", "figure": "Vecna Handyhalter", "wmin": 31.6, "wmax": 32.2}, {"code": "38S1", "figure": "Vecna Handyhalter", "wmin": 31.6, "wmax": 32.2}, {"code": "13S1", "figure": "Will upside Down", "wmin": 30.9, "wmax": 30.9}];

  const codeEl = document.getElementById('code');
  const weightEl = document.getElementById('weight');
  const outEl = document.getElementById('out');
  const figureSel = document.getElementById('figureSel');
  const wFigureEl = document.getElementById('wFigure');
  const figureOutEl = document.getElementById('figureOut');

  function fmt(n) { return (typeof n==='number' && !isNaN(n)) ? n.toFixed(1) : '‚Äì'; }

  function updateStats() {
    document.getElementById('statCount').textContent = rows.length + ' Eintr√§ge';
    const tbody = document.getElementById('previewTable').querySelector('tbody');
    tbody.innerHTML='';
    const take = Math.min(8, rows.length);
    for(let i=0;i<take;i++) {
      const r = rows[i];
      const tr = document.createElement('tr');
      tr.innerHTML = '<td>'+r.code+'</td><td>'+r.figure+'</td><td>'+fmt(r.wmin)+'‚Äì'+fmt(r.wmax)+' g</td>';
      tbody.appendChild(tr);
    }
    document.getElementById('previewTable').style.display = take? 'table' : 'none';

    // Populate figure dropdown
    const figs = Array.from(new Set(rows.map(r=>r.figure))).sort((a,b)=>a.localeCompare(b,'de'));
    figureSel.innerHTML = '<option value="">‚Äì Figur ausw√§hlen ‚Äì</option>' + figs.map(f=>'<option value="'+f+'">'+f+'</option>').join('');
  }

  function dedupFigures(list){
    const seen = new Set();
    const out = [];
    for(const r of list){
      if(!seen.has(r.figure)){ seen.add(r.figure); out.push(r); }
    }
    return out;
  }

  function findByCode(code, weight){
    const c = (code||'').toUpperCase().trim();
    let list = rows.filter(r => r.code===c);
    if(weight!=null && !isNaN(weight)) {
      const w = Number(weight);
      const exact = list.filter(r => (typeof r.wmin==='number' && typeof r.wmax==='number' && w>=r.wmin && w<=r.wmax));
      if(exact.length) return {mode:'exact', list:dedupFigures(exact)};
      list = list.map(r=>({r, d:(typeof r.wmin==='number'&&typeof r.wmax==='number')? Math.abs(w-((r.wmin+r.wmax)/2)) : 999}))
                 .sort((a,b)=>a.d-b.d).map(x=>x.r);
      return {mode:'nearest', list:dedupFigures(list)};
    }
    return {mode:'code', list:dedupFigures(list)};
  }

  function renderResult(res, code, weight){
    if(!res.list.length){
      outEl.innerHTML = '<div class="muted">Keine Treffer f√ºr <strong>'+(code||'‚Äì')+'</strong>'+(weight?(' bei '+weight+' g'):'')+'.</div>';
      return;
    }
    const chips = res.list.map(r=>'<span class="chip">'+r.figure+' <span class="muted">('+fmt(r.wmin)+'‚Äì'+fmt(r.wmax)+' g)</span></span>').join(' ');
    const modeTxt = res.mode==='exact'? '<span style="color:#0bb87f">Exakter Gewichtstreffer</span>' : (res.mode==='code'? '<span style="color:#ffd166">Nur nach Seriennummer</span>' : '<span style="color:#ffd166">N√§chstliegend nach Gewicht</span>');
    outEl.innerHTML = '<div class="list">'+chips+'</div><div style="margin-top:8px" class="muted">Modus: '+modeTxt+'</div>';
  }

  // Figure-specific search
  function findByFigure(fig, weight){
    let list = rows.filter(r=>r.figure===fig);
    const codes = Array.from(new Set(list.map(r=>r.code))).sort((a,b)=>{
      // numeric-ish sort on prefix number
      const na = parseInt(a,10), nb = parseInt(b,10);
      if(!isNaN(na) && !isNaN(nb)) return na-nb;
      return a.localeCompare(b,'de');
    });
    let weightMatch = [];
    let nearest = null;
    if(weight!=null && !isNaN(weight)){
      const w = Number(weight);
      weightMatch = list.filter(r => (typeof r.wmin==='number' && typeof r.wmax==='number' && w>=r.wmin && w<=r.wmax));
      if(!weightMatch.length){
        const withD = list.map(r=>({r, d:(typeof r.wmin==='number'&&typeof r.wmax==='number')? Math.abs(w-((r.wmin+r.wmax)/2)) : 999}))
                          .sort((a,b)=>a.d-b.d);
        nearest = withD.length? withD[0].r : null;
      }
    }
    return {codes, list, weightMatch, nearest};
  }

  function renderFigureResult(fig, weight){
    if(!fig){
      figureOutEl.innerHTML = 'W√§hle eine Figur aus.';
      return;
    }
    const w = (weight||'').trim()? Number((weight||'').replace(',', '.')) : null;
    const res = findByFigure(fig, w);
    let html = '';
    html += '<div><strong>Figur:</strong> '+fig+'</div>';
    html += '<div style="margin-top:6px"><strong>Alle Seriennummern:</strong> '+ (res.codes.length? res.codes.map(c=>'<span class="chip">'+c+'</span>').join(' ') : '<span class="muted">Keine Codes gefunden</span>') +'</div>';
    const ranges = Array.from(new Set(res.list.map(r=> (fmt(r.wmin)+'‚Äì'+fmt(r.wmax)+' g') )));
    html += '<div style="margin-top:6px"><strong>Gewichtsbereiche:</strong> '+ (ranges.length? ranges.map(x=>'<span class="chip">'+x+'</span>').join(' ') : '<span class="muted">‚Äì</span>') +'</div>';
    if(w!=null && !isNaN(w)){
      html += '<div style="margin-top:10px"><strong>Pr√ºfung Gewicht ('+w.toFixed(1)+' g):</strong> ';
      if(res.weightMatch.length){
        const codes = Array.from(new Set(res.weightMatch.map(r=>r.code))).map(c=>'<span class="chip">'+c+'</span>').join(' ');
        html += '<div>Passende Codes f√ºr dieses Gewicht: '+codes+'</div>';
      }else{
        if(res.nearest){
          html += '<div class="muted">Kein exakter Treffer. N√§chstliegend: <span class="chip">'+res.nearest.code+'</span> ('+fmt(res.nearest.wmin)+'‚Äì'+fmt(res.nearest.wmax)+' g)</div>';
        }else{
          html += '<div class="muted">Keine Gewichtsinfos f√ºr diese Figur vorhanden.</div>';
        }
      }
      html += '</div>';
    }
    figureOutEl.innerHTML = html;
  }

  document.getElementById('checkBtn').addEventListener('click', ()=>{
    const code = codeEl.value;
    const wtxt = (weightEl.value||'').replace(',', '.');
    const w = wtxt? Number(wtxt) : null;
    const res = findByCode(code, w);
    renderResult(res, code, w);
  });

  document.getElementById('resetBtn').addEventListener('click', ()=>{
    codeEl.value = '';
    weightEl.value = '';
    outEl.textContent = 'Gib oben eine Seriennummer ein.';
  });

  document.getElementById('figureBtn').addEventListener('click', ()=>{
    renderFigureResult(figureSel.value, wFigureEl.value);
  });

  document.getElementById('figureReset').addEventListener('click', ()=>{
    figureSel.value = '';
    wFigureEl.value = '';
    figureOutEl.textContent = 'W√§hle eine Figur aus.';
  });

  // CSV loader (optional override)
  function parseCSV(text){
    const lines = text.split(/\r?\n/).filter(l=>l.trim().length);
    const out=[];
    for(const line of lines){
      const raw = line.includes(';') && !line.includes(',') ? line.split(';') : line.split(',');
      const a = raw.map(x=>x.trim());
      if(a.length>=2){
        const code = a[0].toUpperCase();
        const fig = a[1];
        const lo = a[2]? Number(a[2].replace(',', '.')) : NaN;
        const hi = a[3]? Number(a[3].replace(',', '.')) : NaN;
        out.push({code:code, figure:fig, wmin:isNaN(lo)? undefined : lo, wmax:isNaN(hi)? undefined : hi});
      }
    }
    return out;
  }
  document.getElementById('loadCsvBtn')?.addEventListener('click', ()=>{
    const ta = document.getElementById('paste').value.trim();
    if(ta){
      rows = parseCSV(ta);
      updateStats();
      outEl.textContent = 'Daten geladen. Gib oben eine Seriennummer ein.';
      figureOutEl.textContent = 'W√§hle eine Figur aus.';
      return;
    }
    const file = document.getElementById('csvfile').files[0];
    if(file){
      const fr = new FileReader();
      fr.onload = e => { rows = parseCSV(e.target.result); updateStats(); outEl.textContent='Daten geladen. Gib oben eine Seriennummer ein.'; figureOutEl.textContent='W√§hle eine Figur aus.'; };
      fr.readAsText(file, 'utf-8');
    }
  });

  updateStats();
</script>
</body>
</html>
